!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.util.VK"),e=function(t){return t.target_list},o=function(t){return t.rel_list},i=function(t){return t.link_class_list},k=function(t){return"boolean"==typeof t.link_assume_external_targets&&t.link_assume_external_targets},l=function(t){return"boolean"==typeof t.link_context_toolbar&&t.link_context_toolbar},r=function(t){return t.link_list},y=function(t){return"string"==typeof t.default_link_target},b=function(t){return t.default_link_target},_=e,w=function(t,e){t.settings.target_list=e},T=function(t){return!1!==e(t)},C=o,M=function(t){return o(t)!==undefined},O=i,R=function(t){return i(t)!==undefined},N=function(t){return!1!==t.link_title},A=function(t){return"boolean"==typeof t.allow_unsafe_link_target&&t.allow_unsafe_link_target},a=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),u=tinymce.util.Tools.resolve("tinymce.Env"),s=function(t){if(!u.ie||10<u.ie){var e=document.createElement("a");e.target="_blank",e.href=t,e.rel="noreferrer noopener";var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r=e,l=n,document.body.appendChild(r),r.dispatchEvent(l),document.body.removeChild(r)}else{var o=window.open("","_blank");if(o){o.opener=null;var i=o.document;i.open(),i.write('<meta http-equiv="refresh" content="0; url='+a.DOM.encode(t)+'">'),i.close()}}var r,l},E=tinymce.util.Tools.resolve("tinymce.util.Tools"),c=function(t,e){var n,o,i=["noopener"],r=t?t.split(/\s+/):[],l=function(t){return t.filter(function(t){return-1===E.inArray(i,t)})};return(r=e?(n=l(n=r)).length?n.concat(i):i:l(r)).length?(o=r,E.trim(o.sort().join(" "))):null},f=function(t,e){return e=e||t.selection.getNode(),g(e)?t.dom.select("a[href]",e)[0]:t.dom.getParent(e,"a[href]")},d=function(t){return t&&"A"===t.nodeName&&t.href},g=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},m=function(t,e){var n,o;(o=t.dom.select("img",e)[0])&&(n=t.dom.getParents(o,"a[href]",e)[0])&&(n.parentNode.insertBefore(o,n),t.dom.remove(n))},v=function(t,e,n){var o,i;(i=t.dom.select("img",e)[0])&&(o=t.dom.create("a",n),i.parentNode.insertBefore(o,i),o.appendChild(i))},L=function(i,r){return function(o){i.undoManager.transact(function(){var t=i.selection.getNode(),e=f(i,t),n={href:o.href,target:o.target?o.target:null,rel:o.rel?o.rel:null,"class":o["class"]?o["class"]:null,title:o.title?o.title:null};M(i.settings)||!1!==A(i.settings)||(n.rel=c(n.rel,"_blank"===n.target)),o.href===r.href&&(r.attach(),r={}),i.settings.link_attrs&&i.settings.link_attrs.length&&i.settings.link_attrs.forEach(function(t){n[t]=o[t]?o[t]:null}),e?(i.focus(),o.hasOwnProperty("text")&&("innerText"in e?e.innerText=o.text:e.textContent=o.text),i.dom.setAttribs(e,n),i.selection.select(e),i.undoManager.add()):g(t)?v(i,t,n):o.hasOwnProperty("text")?i.insertContent(i.dom.createHTML("a",n,i.dom.encode(o.text))):i.execCommand("mceInsertLink",!1,n)})}},P=function(e){return function(){e.undoManager.transact(function(){var t=e.selection.getNode();g(t)?m(e,t):e.execCommand("unlink")})}},h=d,x=function(t){return 0<E.grep(t,d).length},S=function(t){return!(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))},I=f,K=function(t,e){var n=e?e.innerText||e.textContent:t.getContent({format:"text"});return n.replace(/\uFEFF/g,"")},U=c,p=tinymce.util.Tools.resolve("tinymce.util.Delay"),D=tinymce.util.Tools.resolve("tinymce.util.XHR"),B={},F=function(t,o,e){var i=function(t,n){return n=n||[],E.each(t,function(t){var e={text:t.text||t.title};t.menu?e.menu=i(t.menu):(e.value=t.value,o&&o(e)),n.push(e)}),n};return i(t,e||[])},q=function(e,t,n){var o=e.selection.getRng();p.setEditorTimeout(e,function(){e.windowManager.confirm(t,function(t){e.selection.setRng(o),n(t)})})},V=function(l,t){var e,a,o,u,n,i,r,s,c,f,d,g={},m=l.selection,v=l.dom,h=function(t){var e=o.find("#text");(!e.value()||t.lastControl&&e.value()===t.lastControl.text())&&e.value(t.control.text()),o.find("#href").value(t.control.value())},x=function(){a||!u||g.text||this.parent().parent().find("#text")[0].value(this.value())};u=S(m.getContent()),e=I(l),g.text=a=K(l.selection,e),g.href=e?v.getAttrib(e,"href"):"",e?g.target=v.getAttrib(e,"target"):y(l.settings)&&(g.target=b(l.settings)),(d=v.getAttrib(e,"rel"))&&(g.rel=d),(d=v.getAttrib(e,"class"))&&(g["class"]=d),(d=v.getAttrib(e,"title"))&&(g.title=d),u&&(n={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){g.text=this.value()}}),t&&(i={type:"listbox",label:"Link list",values:F(t,function(t){t.value=l.convertURL(t.value||t.url,"href")},[{text:"None",value:""}]),onselect:h,value:l.convertURL(g.href,"href"),onPostRender:function(){i=this}}),T(l.settings)&&(_(l.settings)===undefined&&w(l,[{text:"None",value:""},{text:"New window",value:"_blank"}]),s={name:"target",type:"listbox",label:"Target",values:F(_(l.settings))}),M(l.settings)&&(r={name:"rel",type:"listbox",label:"Rel",values:F(C(l.settings),function(t){!1===A(l.settings)&&(t.value=U(t.value,"_blank"===g.target))})}),R(l.settings)&&(c={name:"class",type:"listbox",label:"Class",values:F(O(l.settings),function(t){t.value&&(t.textStyle=function(){return l.formatter.getCssText({inline:"a",classes:[t.value]})})})}),N(l.settings)&&(f={name:"title",type:"textbox",label:"Title",value:g.title});var p=[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:function(t){var e=t.meta||{};i&&i.value(l.convertURL(this.value(),"href")),E.each(t.meta,function(t,e){var n=o.find("#"+e);"text"===e?0===a.length&&(n.value(t),g.text=t):n.value(t)}),e.attach&&(B={href:this.value(),attach:e.attach}),e.text||x.call(this)},onkeyup:x,onpaste:x,onbeforecall:function(t){t.meta=o.toJSON()}},n,f,function(n){var o=[];if(E.each(l.dom.select("a:not([href])"),function(t){var e=t.name||t.id;e&&o.push({text:e,value:"#"+e,selected:-1!==n.indexOf("#"+e)})}),o.length)return o.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:o,onselect:h}}(g.href),i,r,s,c];l.settings.link_attrs&&l.settings.link_attrs.length&&l.settings.link_attrs.forEach(function(t){p.push({name:t,type:"textbox",label:t,value:v.getAttrib(e,t)})}),o=l.windowManager.open({title:"Insert link",data:g,body:p,onSubmit:function(t){var e=k(l.settings),n=L(l,B),o=P(l),i=E.extend({},g,t.data),r=i.href;r?(u&&i.text!==a||delete i.text,0<r.indexOf("@")&&-1===r.indexOf("//")&&-1===r.indexOf("mailto:")?q(l,"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(t){t&&(i.href="mailto:"+r),n(i)}):!0===e&&!/^\w+:/i.test(r)||!1===e&&/^\s*www[\.|\d\.]/i.test(r)?q(l,"The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(t){t&&(i.href="http://"+r),n(i)}):n(i)):o()}})},z=function(t){var e,n,o;n=V,"string"==typeof(o=r((e=t).settings))?D.send({url:o,success:function(t){n(e,JSON.parse(t))}}):"function"==typeof o?o(function(t){n(e,t)}):n(e,o)},H=function(t,e){return t.dom.getParent(e,"a[href]")},J=function(t){return H(t,t.selection.getStart())},$=function(t,e){if(e){var n=(i=e).getAttribute("data-mce-href")||i.getAttribute("href");if(/^#/.test(n)){var o=t.$(n);o.length&&t.selection.scrollIntoView(o[0],!0)}else s(e.href)}var i},j=function(t){return function(){z(t)}},G=function(t){return function(){$(t,J(t))}},X=function(r){return function(t){var e,n,o,i;return!!(l(r.settings)&&(!(i=r.plugins.contextmenu)||!i.isContextMenuVisible())&&h(t)&&3===(o=(n=(e=r.selection).getRng()).startContainer).nodeType&&e.isCollapsed()&&0<n.startOffset&&n.startOffset<o.data.length)}},Q=function(o){o.on("click",function(t){var e=H(o,t.target);e&&n.metaKeyPressed(t)&&(t.preventDefault(),$(o,e))}),o.on("keydown",function(t){var e,n=J(o);n&&13===t.keyCode&&!0===(e=t).altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey&&(t.preventDefault(),$(o,n))})},W=function(n){return function(){var e=this;n.on("nodechange",function(t){e.active(!n.readonly&&!!I(n,t.element))})}},Y=function(n){return function(){var e=this,t=function(t){x(t.parents)?e.show():e.hide()};x(n.dom.getParents(n.selection.getStart()))||e.hide(),n.on("nodechange",t),e.on("remove",function(){n.off("nodechange",t)})}},Z=function(t){t.addCommand("mceLink",j(t))},tt=function(t){t.addShortcut("Meta+K","",j(t))},et=function(t){t.addButton("link",{active:!1,icon:"link",tooltip:"Insert/edit link",onclick:j(t),onpostrender:W(t)}),t.addButton("unlink",{active:!1,icon:"unlink",tooltip:"Remove link",onclick:P(t),onpostrender:W(t)}),t.addContextToolbar&&t.addButton("openlink",{icon:"newtab",tooltip:"Open link",onclick:G(t)})},nt=function(t){t.addMenuItem("openlink",{text:"Open link",icon:"newtab",onclick:G(t),onPostRender:Y(t),prependToContext:!0}),t.addMenuItem("link",{icon:"link",text:"Link",shortcut:"Meta+K",onclick:j(t),stateSelector:"a[href]",context:"insert",prependToContext:!0}),t.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onclick:P(t),stateSelector:"a[href]"})},ot=function(t){t.addContextToolbar&&t.addContextToolbar(X(t),"openlink | link unlink")};t.add("link",function(t){et(t),nt(t),ot(t),Q(t),Z(t),tt(t)})}();